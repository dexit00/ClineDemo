# ECShop 商品管理機能設計書

## 1. 機能概要

### 1.1 機能目的
商品の登録、更新、削除、検索機能を提供し、ECサイトの商品カタログを管理する。

### 1.2 主要機能
- 商品一覧表示・検索・フィルタリング
- 商品詳細表示
- 商品の作成・更新・削除（管理者のみ）
- 在庫管理
- 商品画像管理

### 1.3 対象ユーザー
- **一般ユーザー**: 商品閲覧・検索
- **管理者**: 商品の全操作（CRUD）

## 2. システム構成

### 2.1 アーキテクチャ図
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  ProductList    │    │ ProductsController│    │ ProductService  │
│  ProductCard    │◄──►│                 │◄──►│                 │
│  SearchFilter   │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                                                        ▼
                                               ┌─────────────────┐
                                               │ProductRepository│
                                               │                 │
                                               └─────────────────┘
                                                        │
                                                        ▼
                                               ┌─────────────────┐
                                               │   Product       │
                                               │   Entity        │
                                               └─────────────────┘
```

### 2.2 レイヤー構成

#### Presentation Layer (Controllers)
- **ProductsController**: 商品API エンドポイント
- **AdminController**: 管理者向け商品管理API

#### Business Layer (Services)
- **ProductService**: 商品ビジネスロジック
- **IProductService**: サービスインターフェース

#### Data Access Layer (Repositories)
- **ProductRepository**: 商品データアクセス
- **IProductRepository**: リポジトリインターフェース

#### Domain Layer (Models)
- **Product**: 商品エンティティ
- **ProductDto**: データ転送オブジェクト

## 3. データモデル

### 3.1 Product エンティティ
```csharp
public class Product
{
    public int Id { get; set; }                    // 商品ID（主キー）
    public string Name { get; set; }               // 商品名（必須、最大100文字）
    public string Description { get; set; }        // 商品説明（必須、最大500文字）
    public decimal Price { get; set; }             // 価格（必須、0以上）
    public string ImageUrl { get; set; }           // 画像URL（オプション、最大200文字）
    public int Stock { get; set; }                 // 在庫数（必須、0以上）
    public DateTime CreatedAt { get; set; }        // 作成日時
}
```

### 3.2 ProductDto クラス
```csharp
// 商品検索リクエスト
public class ProductSearchRequest
{
    public string? Search { get; set; }            // 検索キーワード
    public decimal? MinPrice { get; set; }         // 最低価格
    public decimal? MaxPrice { get; set; }         // 最高価格
    public string? SortBy { get; set; }            // ソート項目
    public string? SortOrder { get; set; }         // ソート順
}

// 商品作成リクエスト
public class CreateProductRequest
{
    public string Name { get; set; }               // 商品名
    public string Description { get; set; }        // 商品説明
    public decimal Price { get; set; }             // 価格
    public string? ImageUrl { get; set; }          // 画像URL
    public int Stock { get; set; }                 // 在庫数
}

// 商品更新リクエスト
public class UpdateProductRequest
{
    public string Name { get; set; }               // 商品名
    public string Description { get; set; }        // 商品説明
    public decimal Price { get; set; }             // 価格
    public string? ImageUrl { get; set; }          // 画像URL
    public int Stock { get; set; }                 // 在庫数
}

// 商品レスポンス
public class ProductResponse
{
    public int Id { get; set; }                    // 商品ID
    public string Name { get; set; }               // 商品名
    public string Description { get; set; }        // 商品説明
    public decimal Price { get; set; }             // 価格
    public string ImageUrl { get; set; }           // 画像URL
    public int Stock { get; set; }                 // 在庫数
    public DateTime CreatedAt { get; set; }        // 作成日時
}
```

## 4. API仕様

### 4.1 商品一覧取得
- **エンドポイント**: `GET /api/products`
- **認証**: 不要
- **機能**: 商品一覧を検索・フィルタリング・ソートして取得

#### パラメータ
| パラメータ | 型 | 必須 | 説明 |
|-----------|---|------|------|
| search | string | × | 商品名・説明での部分一致検索 |
| minPrice | decimal | × | 最低価格フィルタ |
| maxPrice | decimal | × | 最高価格フィルタ |
| sortBy | string | × | ソート項目（price, name, date） |
| sortOrder | string | × | ソート順（asc, desc） |

#### 処理フロー
1. **クエリパラメータ解析**: HttpContextからsearch、minPrice、maxPrice等を取得
2. **データベース検索**: ECShopContextを使用してProductsテーブルから商品を取得
3. **検索条件適用**: 
   - searchがある場合: 商品名または説明に部分一致する商品を抽出
   - minPrice/maxPriceがある場合: 価格でフィルタリング
4. **ソート処理**: sortByとsortOrderに基づいて結果をソート
5. **JSON変換**: 取得した商品リストをJSON形式で返却

### 4.2 商品詳細取得
- **エンドポイント**: `GET /api/products/{id}`
- **認証**: 不要
- **機能**: 指定IDの商品詳細を取得

#### 処理フロー
1. **URLパラメータ取得**: ルートパラメータからidを取得
2. **データベース検索**: ECShopContextを使用してProductsテーブルから指定IDの商品を検索
3. **存在チェック**: 商品が見つからない場合は404エラーを返却
4. **JSON変換**: 取得した商品情報をJSON形式で返却

### 4.3 商品作成
- **エンドポイント**: `POST /api/products`
- **認証**: 必要（管理者権限）
- **機能**: 新しい商品を作成

#### 処理フロー
1. **認証チェック**: JWTトークンから管理者権限を確認
2. **リクエストボディ取得**: JSONからname、description、price、stock等を取得
3. **バリデーション**: 商品名、価格、在庫数の妥当性をチェック
4. **商品エンティティ作成**: 新しいProductオブジェクトを作成
5. **データベース保存**: ECShopContextを使用してProductsテーブルに追加
6. **JSON変換**: 作成された商品情報をJSON形式で返却

### 4.4 商品更新
- **エンドポイント**: `PUT /api/products/{id}`
- **認証**: 必要（管理者権限）
- **機能**: 指定IDの商品を更新

#### 処理フロー
1. **認証チェック**: JWTトークンから管理者権限を確認
2. **URLパラメータ取得**: ルートパラメータからidを取得
3. **商品検索**: ECShopContextを使用して指定IDの商品を検索
4. **存在チェック**: 商品が見つからない場合は404エラーを返却
5. **商品情報更新**: 取得した商品エンティティのプロパティを更新
6. **データベース保存**: SaveChangesAsyncを呼び出して変更を保存

### 4.5 商品削除
- **エンドポイント**: `DELETE /api/products/{id}`
- **認証**: 必要（管理者権限）
- **機能**: 指定IDの商品を削除

#### 処理フロー
1. **認証チェック**: JWTトークンから管理者権限を確認
2. **URLパラメータ取得**: ルートパラメータからidを取得
3. **商品検索**: ECShopContextを使用して指定IDの商品を検索
4. **存在チェック**: 商品が見つからない場合は404エラーを返却
5. **商品削除**: Removeメソッドで商品をコンテキストから削除
6. **データベース保存**: SaveChangesAsyncを呼び出して変更を保存

## 5. ビジネスロジック

## 5. Controller・Action別処理設計

### 5.1 ProductsController

#### GET /api/products (GetProducts Action)
**処理概要**: 商品一覧を検索・フィルタリング・ソートして取得

**リクエスト**
- **クエリパラメータ**:
  - `search` (string, 任意): 商品名・説明での検索キーワード
  - `minPrice` (decimal, 任意): 最低価格フィルタ
  - `maxPrice` (decimal, 任意): 最高価格フィルタ
  - `sortBy` (string, 任意): ソート項目（"price", "name", "date"）
  - `sortOrder` (string, 任意): ソート順（"asc", "desc"）

**レスポンス**
```json
[
  {
    "id": 1,
    "name": "商品名",
    "description": "商品説明",
    "price": 1000.00,
    "imageUrl": "https://example.com/image.jpg",
    "stock": 10,
    "createdAt": "2024-01-01T00:00:00Z"
  }
]
```

**処理フロー**:
1. **クエリパラメータ取得**: HttpContextからsearch、minPrice、maxPrice等を取得
2. **データベース検索**: ECShopContextを使用してProductsテーブルから商品を取得
3. **検索条件適用**:
   - searchがある場合: 商品名または説明に部分一致する商品を抽出
   - minPriceがある場合: 指定価格以上の商品を抽出
   - maxPriceがある場合: 指定価格以下の商品を抽出
4. **ソート処理**: sortByとsortOrderに基づいて結果をソート
5. **JSON変換**: 取得した商品リストをJSON形式で返却

**エラー処理**: 
- バリデーションエラー → 400 Bad Request
- データベースエラー → 500 Internal Server Error

#### GET /api/products/{id} (GetProduct Action)
**処理概要**: 指定IDの商品詳細を取得

**リクエスト**
- **URLパラメータ**:
  - `id` (int, 必須): 商品ID

**レスポンス**
```json
{
  "id": 1,
  "name": "商品名",
  "description": "商品説明",
  "price": 1000.00,
  "imageUrl": "https://example.com/image.jpg",
  "stock": 10,
  "createdAt": "2024-01-01T00:00:00Z"
}
```

**処理フロー**:
1. **URLパラメータ取得**: ルートパラメータからidを取得
2. **ID検証**: idが正の整数であることを確認
3. **データベース検索**: ECShopContextを使用してProductsテーブルから指定IDの商品を検索
4. **存在チェック**: 商品が見つからない場合は404エラーを返却
5. **JSON変換**: 取得した商品情報をJSON形式で返却

**エラー処理**: 
- 商品不存在 → 404 Not Found
- 無効なID → 400 Bad Request

#### POST /api/products (PostProduct Action)
**処理概要**: 新しい商品を作成（管理者権限必要）

**リクエスト**
- **ヘッダー**: `Authorization: Bearer {JWT_TOKEN}`
- **リクエストボディ**:
```json
{
  "name": "商品名",
  "description": "商品説明",
  "price": 1000.00,
  "imageUrl": "https://example.com/image.jpg",
  "stock": 10
}
```

**レスポンス** (201 Created)
```json
{
  "id": 1,
  "name": "商品名",
  "description": "商品説明",
  "price": 1000.00,
  "imageUrl": "https://example.com/image.jpg",
  "stock": 10,
  "createdAt": "2024-01-01T00:00:00Z"
}
```

**処理フロー**:
1. **認証チェック**: JWTトークンから管理者権限を確認
2. **リクエストボディ取得**: JSONからname、description、price、stock等を取得
3. **バリデーション**: 
   - nameが空でないこと
   - priceが0以上であること
   - stockが0以上であること
4. **商品エンティティ作成**: 新しいProductオブジェクトを作成
5. **データベース保存**: ECShopContextを使用してProductsテーブルに追加
6. **作成日時設定**: CreatedAtに現在日時を設定
7. **JSON変換**: 作成された商品情報をJSON形式で返却

**エラー処理**: 
- 権限不足 → 403 Forbidden
- バリデーションエラー → 400 Bad Request
- データベースエラー → 500 Internal Server Error

#### PUT /api/products/{id} (PutProduct Action)
**処理概要**: 指定IDの商品を更新（管理者権限必要）

**リクエスト**
- **ヘッダー**: `Authorization: Bearer {JWT_TOKEN}`
- **URLパラメータ**:
  - `id` (int, 必須): 商品ID
- **リクエストボディ**:
```json
{
  "name": "更新後商品名",
  "description": "更新後商品説明",
  "price": 1200.00,
  "imageUrl": "https://example.com/new-image.jpg",
  "stock": 15
}
```

**レスポンス** (204 No Content)
- レスポンスボディなし

**処理フロー**:
1. **認証チェック**: JWTトークンから管理者権限を確認
2. **URLパラメータ取得**: ルートパラメータからidを取得
3. **リクエストボディ取得**: JSONから更新データを取得
4. **バリデーション**: 
   - nameが空でないこと
   - priceが0以上であること
   - stockが0以上であること
5. **商品検索**: ECShopContextを使用して指定IDの商品を検索
6. **存在チェック**: 商品が見つからない場合は404エラーを返却
7. **商品情報更新**: 取得した商品エンティティのプロパティを更新
8. **データベース保存**: SaveChangesAsyncを呼び出して変更を保存
9. **レスポンス**: 204 No Contentを返却

**エラー処理**: 
- 権限不足 → 403 Forbidden
- 商品不存在 → 404 Not Found
- バリデーションエラー → 400 Bad Request

#### DELETE /api/products/{id} (DeleteProduct Action)
**処理概要**: 指定IDの商品を削除（管理者権限必要）

**リクエスト**
- **ヘッダー**: `Authorization: Bearer {JWT_TOKEN}`
- **URLパラメータ**:
  - `id` (int, 必須): 商品ID

**レスポンス** (204 No Content)
- レスポンスボディなし

**処理フロー**:
1. **認証チェック**: JWTトークンから管理者権限を確認
2. **URLパラメータ取得**: ルートパラメータからidを取得
3. **商品検索**: ECShopContextを使用して指定IDの商品を検索
4. **存在チェック**: 商品が見つからない場合は404エラーを返却
5. **商品削除**: Removeメソッドで商品をコンテキストから削除
6. **データベース保存**: SaveChangesAsyncを呼び出して変更を保存
7. **レスポンス**: 204 No Contentを返却

**エラー処理**: 
- 権限不足 → 403 Forbidden
- 商品不存在 → 404 Not Found
- データベースエラー → 500 Internal Server Error

### 5.2 AdminController（商品管理関連）

#### GET /api/admin/products (GetAllProducts Action)
**処理概要**: 管理者向け商品一覧取得
1. **入力**: なし
2. **処理フロー**:
   - JWTトークンから管理者権限を確認
   - ECShopContextを使用してProductsテーブルから全商品を取得
   - 商品リストを名前順でソート
3. **出力**: Product エンティティのリスト（JSON）
4. **エラー処理**: 権限不足 → 403 Forbidden

#### POST /api/admin/products (CreateProduct Action)
**処理概要**: 管理者による商品作成
1. **入力**: Product エンティティ（リクエストボディ）
2. **処理フロー**:
   - JWTトークンから管理者権限を確認
   - 新しいProductエンティティを作成し、CreatedAtに現在日時を設定
   - ECShopContextを使用してProductsテーブルに追加
   - SaveChangesAsyncでデータベースに保存
3. **出力**: 作成された Product エンティティ（JSON）、201 Created
4. **エラー処理**: 権限不足 → 403 Forbidden

#### PUT /api/admin/products/{id} (UpdateProduct Action)
**処理概要**: 管理者による商品更新
1. **入力**: 商品ID（URLパラメータ）、Product エンティティ（リクエストボディ）
2. **処理フロー**:
   - 管理者権限チェック
   - IDの一致確認
   - 既存商品の取得・存在確認
   - 商品情報の更新
   - データベース保存
3. **出力**: 更新成功メッセージ（JSON）
4. **エラー処理**: ID不一致 → 400 Bad Request、商品不存在 → 404 Not Found

#### DELETE /api/admin/products/{id} (DeleteProduct Action)
**処理概要**: 管理者による商品削除
1. **入力**: 商品ID（URLパラメータ）
2. **処理フロー**:
   - 管理者権限チェック
   - 商品の取得・存在確認
   - 商品の削除
   - データベース保存
3. **出力**: 削除成功メッセージ（JSON）
4. **エラー処理**: 商品不存在 → 404 Not Found

### 5.3 ビジネスロジック設計方針

#### Service層の責務
- **ProductService**: 商品に関するビジネスロジックを集約
- **バリデーション**: 入力データの妥当性チェック
- **データ変換**: エンティティとDTOの相互変換
- **ログ出力**: 操作履歴の記録
- **例外処理**: ビジネスルール違反時の適切な例外スロー

#### Repository層の責務
- **ProductRepository**: データアクセスロジックを集約
- **CRUD操作**: 基本的なデータベース操作
- **検索機能**: 条件に基づくデータ取得
- **在庫管理**: 在庫数の更新・チェック

#### バリデーションルール
- **商品名**: 必須、最大100文字
- **商品説明**: 必須、最大500文字
- **価格**: 必須、0以上
- **在庫数**: 必須、0以上
- **画像URL**: オプション、最大200文字

#### エラーハンドリング方針
- **ArgumentException**: バリデーションエラー → 400 Bad Request
- **ArgumentNullException**: 必須パラメータ不足 → 400 Bad Request
- **InvalidOperationException**: ビジネスルール違反 → 400 Bad Request
- **その他の例外**: 予期しないエラー → 500 Internal Server Error

## 6. データアクセス層

### 6.1 ProductRepository 主要メソッド

#### SearchAsync()
**処理概要**: 検索条件に基づいて商品を検索する
1. **基本クエリ作成**: Products テーブルに対するクエリを初期化
2. **検索キーワード処理**（searchパラメータが指定されている場合）
   - 検索キーワードを小文字に変換
   - 商品名または商品説明に部分一致する商品を抽出
   - SQLite制限対応のため、ToLower()で大文字小文字を統一
3. **最低価格フィルタ**（minPriceが指定されている場合）
   - 指定価格以上の商品のみを抽出
4. **最高価格フィルタ**（maxPriceが指定されている場合）
   - 指定価格以下の商品のみを抽出
5. **結果取得**: 条件に合致する商品リストを非同期で取得して返却

#### IsStockAvailableAsync()
**処理概要**: 指定商品の在庫が十分かチェックする
1. 商品IDで商品エンティティを検索
2. 商品が存在し、かつ在庫数が要求数量以上の場合はtrue
3. 商品が存在しない、または在庫不足の場合はfalse
4. 注文処理前の在庫確認で使用

#### UpdateStockAsync()
**処理概要**: 商品の在庫数を更新する
1. 商品IDで商品エンティティを検索
2. 商品が存在しない場合はfalseを返却
3. 在庫数に変更量を加算（減算の場合は負の値）
4. 在庫数が0未満になった場合は0に補正
5. データベースに変更を保存
6. 更新成功時はtrue、失敗時はfalseを返却

## 7. フロントエンド設計

### 7.1 Vue.js コンポーネント構成

#### ProductList.vue
- **役割**: 商品一覧表示のメインコンポーネント
- **機能**: 
  - 商品一覧取得・表示
  - 検索・フィルタリング
  - ページネーション（将来実装）
  - カート機能

#### ProductCard.vue
- **役割**: 個別商品表示コンポーネント
- **機能**:
  - 商品情報表示
  - カートに追加
  - 商品詳細へのリンク

#### SearchFilter.vue
- **役割**: 検索・フィルタリングコンポーネント
- **機能**:
  - キーワード検索
  - 価格範囲フィルタ
  - ソート機能

### 7.2 状態管理

#### ローカル状態（ProductList.vue）
```javascript
data() {
  return {
    products: [],           // 商品一覧
    loading: false,         // ローディング状態
    error: null,           // エラーメッセージ
    cartItems: [],         // カート商品
    cartItemCount: 0       // カート商品数
  }
}
```

#### API通信メソッド
```javascript
async loadProducts(filters = {}) {
  this.loading = true;
  this.error = null;
  
  try {
    const params = new URLSearchParams();
    if (filters.search) params.append('search', filters.search);
    if (filters.minPrice) params.append('minPrice', filters.minPrice);
    if (filters.maxPrice) params.append('maxPrice', filters.maxPrice);
    if (filters.sortBy) params.append('sortBy', filters.sortBy);
    if (filters.sortOrder) params.append('sortOrder', filters.sortOrder);
    
    const url = params.toString() ? `/products?${params}` : '/products';
    const response = await fetch(`http://localhost:5000/api${url}`);
    
    if (!response.ok) throw new Error('Failed to fetch products');
    
    this.products = await response.json();
  } catch (error) {
    this.error = '商品の読み込みに失敗しました。';
  } finally {
    this.loading = false;
  }
}
```

## 8. エラーハンドリング

### 8.1 バックエンドエラー処理

#### GlobalExceptionMiddleware
**処理概要**: アプリケーション全体の例外を統一的に処理する
1. **正常処理**: 次のミドルウェアを呼び出し
2. **ArgumentException捕捉**
   - バリデーションエラーとして扱う
   - HTTPステータス400（Bad Request）でレスポンス
   - HandleExceptionAsyncメソッドでエラーレスポンス生成
3. **ArgumentNullException捕捉**
   - 必須パラメータ不足として扱う
   - HTTPステータス400（Bad Request）でレスポンス
4. **その他の例外捕捉**
   - 予期しないサーバーエラーとして扱う
   - HTTPステータス500（Internal Server Error）でレスポンス
   - 詳細なエラー情報はログに記録、クライアントには汎用メッセージ

#### エラーメッセージ定数
```csharp
public static class ErrorMessages
{
    public static class Product
    {
        public const string PRODUCT_NOT_FOUND = "商品が見つかりません";
        public const string INSUFFICIENT_STOCK = "在庫が不足しています";
    }
    
    public static class Validation
    {
        public const string REQUIRED_FIELD = "必須項目が入力されていません";
        public const string INVALID_RANGE = "値が範囲外です";
        public const string ID_MISMATCH = "IDが一致しません";
    }
}
```

### 8.2 フロントエンドエラー処理

#### API エラーハンドリング
```javascript
try {
  const response = await fetch(url);
  if (!response.ok) {
    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
  }
  return await response.json();
} catch (error) {
  console.error('API Error:', error);
  this.error = 'ネットワークエラーが発生しました。';
  throw error;
}
```

## 9. パフォーマンス最適化

### 9.1 データベース最適化

#### インデックス設定
```sql
CREATE INDEX IX_Products_Name ON Products(Name);
CREATE INDEX IX_Products_Price ON Products(Price);
CREATE INDEX IX_Products_CreatedAt ON Products(CreatedAt);
```

#### SQLite制限対応
- decimal型の集計・ソートはメモリ上で実行
- 大文字小文字の検索はToLower()で統一

### 9.2 フロントエンド最適化

#### 画像遅延読み込み
```javascript
// 将来実装予定
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const img = entry.target;
      img.src = img.dataset.src;
      observer.unobserve(img);
    }
  });
});
```

#### 検索デバウンス
```javascript
// 検索入力のデバウンス処理
debounceSearch: debounce(function(searchTerm) {
  this.loadProducts({ search: searchTerm });
}, 300)
```

## 10. テスト設計

### 10.1 単体テスト

#### ProductService テスト設計

**CreateProductAsync_ValidProduct_ReturnsCreatedProduct テスト**
- **目的**: 正常な商品データで商品作成が成功することを確認
- **準備**: 有効な商品データ（名前、価格、在庫）を用意
- **実行**: CreateProductAsyncメソッドを呼び出し
- **検証**: 
  - 戻り値がnullでないこと
  - 商品名が正しく設定されていること
  - その他の商品属性が期待値と一致すること

**CreateProductAsync_InvalidPrice_ThrowsArgumentException テスト**
- **目的**: 無効な価格（負の値）で例外がスローされることを確認
- **準備**: 価格が-1の無効な商品データを用意
- **実行・検証**: CreateProductAsyncメソッド呼び出し時にArgumentExceptionがスローされることを確認

#### ProductController テスト設計

**GetProducts_ReturnsOkResult テスト**
- **目的**: 商品一覧取得APIが正常にレスポンスを返すことを確認
- **準備**: 
  - モックサービスで商品リストを返すよう設定
  - ProductSearchRequestオブジェクトを用意
- **実行**: GetProductsメソッドを呼び出し
- **検証**:
  - HTTPステータス200（OK）が返されること
  - レスポンスボディが存在すること
  - 期待する商品データが含まれていること

### 10.2 統合テスト

#### API統合テスト設計

**GetProducts_ReturnsProductList テスト**
- **目的**: 商品一覧取得APIの全体的な動作を確認
- **準備**: 
  - テスト用のHTTPクライアントを作成
  - テストデータベースに商品データを事前投入
- **実行**: GET /api/products エンドポイントにリクエスト送信
- **検証**:
  - HTTPレスポンスが成功ステータス（200）であること
  - レスポンスボディがJSON形式で返されること
  - デシリアライズした商品リストが正しい形式であること
  - 期待する商品データが含まれていること
- **特徴**: 実際のHTTPリクエスト/レスポンスを通じてテスト実行

### 10.3 フロントエンドテスト

#### Vue.js コンポーネントテスト設計

**ProductList.vue テスト**

**renders product list テスト**
- **目的**: 商品一覧コンポーネントが正しくレンダリングされることを確認
- **準備**: ProductListコンポーネントをマウント
- **実行**: loadProductsメソッドを呼び出して商品データを読み込み
- **検証**: 
  - .product-card クラスの要素が存在すること
  - 商品カードが適切に表示されること

**handles search filter テスト**
- **目的**: 検索フィルタ機能が正常に動作することを確認
- **準備**: ProductListコンポーネントをマウント
- **実行**: onFiltersChangedメソッドに検索条件（'test'）を渡して呼び出し
- **検証**:
  - products データプロパティが定義されていること
  - フィルタ条件に応じて商品リストが更新されること
  - 検索結果が適切に表示されること

## 11. セキュリティ考慮事項

### 11.1 入力検証
- サーバーサイドでの厳密なバリデーション
- SQLインジェクション対策（Entity Framework使用）
- XSS対策（Vue.jsの自動エスケープ）

### 11.2 認可制御
- 商品作成・更新・削除は管理者のみ
- JWT トークンによる認証
- Role-based アクセス制御

### 11.3 データ保護
- 機密情報の適切な管理
- ログ出力時の個人情報マスキング
- HTTPS通信の強制（本番環境）

## 12. 運用・監視

### 12.1 ログ出力
- 商品操作の監査ログ
- エラー発生時の詳細ログ
- パフォーマンス監視ログ

### 12.2 メトリクス
- 商品検索回数
- 人気商品ランキング
- 在庫切れアラート

### 12.3 バックアップ・復旧
- 商品データの定期バックアップ
- 商品画像の外部ストレージ保存
- 災害復旧計画

## 13. 今後の拡張予定

### 13.1 機能拡張
- 商品カテゴリ分類
- 商品レビュー・評価
- 関連商品表示
- 商品比較機能

### 13.2 技術的改善
- 全文検索エンジン導入（Elasticsearch）
- 商品画像の最適化・CDN配信
- キャッシュ機能の実装
- リアルタイム在庫更新

### 13.3 運用改善
- 商品データの一括インポート・エクスポート
- 商品管理画面の改善
- 在庫管理の自動化
- 売上分析機能
